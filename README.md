# Valetoriy Constexpr ASM Interpreter
> _Без сторонних библиотек!_

## Загрузка:
```sh
git clone https://github.com/Valetoriy/VCAI
```

## Установка и использование:
* Включите файл `vcai.hpp` в папке `include` в собственный проект;
* Вызовите `exec_fn(const char *txt)` с текстом ASM-программы (желательно,
в `constexpr`-контексте);

## Особенности ЯП-а:
* ВСЕ вычисления производятся в 64-х битных целых числах (i64);
* В стеке хранятся ТОЛЬКО значения, добавленные через `push`.
Для обработки вызовов функций и возвращения из них (`call` и `ret`)
используется отдельная структура данных, недоступная для пользователя;
* Выполнение программы начинается с вызова функции `main`.
* Интерпретатор завершает работу при достижении конца исходного файла,
либо при опустошении `call`-стека;
* Значение, возвращаемое exec_fn() - содержимое регистра `r0`;

## Синтаксис:
* `r0-r3` - регистры общего назначения;
* `a0-a3` - дополнительные регистры общего назначения, рекомендуется
использовать их для передачи аргументов в функции;
* `sp` - регистр, содержащий индекс первого пустого элемента в стеке;
* `#` - начало комментария. Комментарий всегда должен занимать строку целеком!
* `label:` - ярлык (название функции);
* `add r0 13 -1` - вызов функции. Запятые не ставить!

## Доступные функции:
* 3 агрумента:
```python
# dst = src1 + src2
# Аналогично для sub (-), mul (*), div (/) и mod (%)
add dst src1 src2
```
* 2 аргумента:
```python
# dst += src
# Аналогично для sub (-), mul (*), div (/) и mod (%)
add dst src
# Сравнение (>/</=)
# Результат сравнения записывается в
# регистры ZF/SF (недоступны для пользователя)
cmp src1 src2
# dst = src
mov dst src
# dst <<= src
shl dst src
# dst >>= src
shr dst src
# dst ^= src
xor dst src
# dst &= src
and dst src
# dst |= src
or dst src
```
* 1 аргумент:
```python
# ++dst
inc dst
# --dst
dec dst
# Переход на ярлык dst
jmp dst
# Переход на ярлык dst,
# если при выполнении cmp - src1 < src2
# (ZF == 0 && SF == 1)
jl dst
# Переход на ярлык dst,
# если при выполнении cmp - src1 == src2
# (ZF == 1)
je dst
# Переход на ярлык dst,
# если при выполнении cmp - src1 != src2
# (ZF != 1)
jne dst
# Переход на ярлык dst,
# если при выполнении cmp - src1 > src2
# (ZF == 0 && SF == 0)
jg dst
# Переход на ярлык dst,
# если при выполнении cmp - src1 <= src2
# (ZF == 1 || SF == 1)
jle dst
# Переход на ярлык dst,
# если при выполнении cmp - src1 >= src2
# (ZF == 1 || SF == 0)
jge dst
# Вызов функции(ярлыка) dst
call dst
# Значение dst ставится на вершину стека
push dst
# С вершины стека снимается элемент
# и кладётся в dst
pop dst
```
* Без аргументов:
```python
# Возвращение из функции в точку её вызова
ret
```
